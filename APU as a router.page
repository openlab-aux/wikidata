## Installation

### Debian

Install a regular Debian amd64.

Edit `/etc/default/grub` and add/change the following values:

```
GRUB_CMDLINE_LINUX_DEFAULT="verbose console=ttyS0,115200n8 reboot=bios"
GRUB_SERIAL_COMMAND="serial --unit=0 --speed=115200"
GRUB_TERMINAL=serial
```

Now we'll have to write grub to the MBR again (as root):

```
update-grub
```

We'll also add a system service that provides a tty over the serial port.
Create `/etc/init/ttyS0.conf` and write the following to it:

```
# ttyS0 - getty

start on stopped rc RUNLEVEL=[2345]
stop on runlevel [!2345]

respawn
exec /sbin/getty -8 115200 -L ttyS0
```

Reboot the system. You should now be able to watch it boot via the serial port
and login once it's done.

### Some utils

```
apt install htop tmux
```

## Configuration

### Network

Edit `/etc/network/interfaces` and add these interfaces:

```
# Local lab network
auto enp1s0
iface enp1s0 inet static
        address 172.16.0.1
        netmask 255.255.0.0

# Link to gamambel
auto enp2s0.25
iface enp2s0.25 inet static
        address 10.11.69.196
        netmask 255.255.255.192

# Debugging network
auto enp3s0
iface enp3s0 inet dhcp
```

Enable IPv4 forwarding by editing `/etc/sysctl.conf`:

```
net.ipv4.ip_forward=1
```

### VPN connection

Install `openvpn` as root:

```
apt install openvpn ca-certificates
```

Copy the VPN configuration to `/etc/openvpn/client/labvpn`. Now edit `/etc/default/openvpn`:

```
AUTOSTART="labvpn"
```

### Firewall 

Install `ufw` as root:

```
apt install ufw
ufw enable
ufw default deny incoming
ufw default allow outgoing
ufw allow ssh
```

Add NAT/masquerading to the top of `/etc/ufw/before.rules`:

```
# NAT over tun0
*nat
:POSTROUTING ACCEPT [0:0]
-A POSTROUTING -s 172.16.0.0/16 -o tun0 -j MASQUERADE

COMMIT
```

### DHCP server

Install `isc-dhcp-server` as root:

```
apt install isc-dhcp-server
systemctl enable isc-dhcp-server
```

Edit `/etc/default/isc-dhcp-server` and configure the interfaces:

```
INTERFACESv4="enp1s0"
```

Edit `/etc/dhcp/dhcpd.conf` for all other settings:

```
#option domain-name "lab";
#option domain-name-servers 8.8.8.8, 8.4.4.8;

authoritative;

subnet 172.16.0.0 netmask 255.255.0.0 {
        range 172.16.0.100 172.16.0.249;
        option routers 172.16.0.1;
        option domain-name "lab";
        option domain-name-servers 8.8.8.8, 8.4.4.8;
}
```

### Prometheus

Install `prometheus` as root:

```
apt install prometheus
```

### SNMP

To be done.
