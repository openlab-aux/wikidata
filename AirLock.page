Wenn wir in die Bäckergasse umziehen, ergeben sich für den Zugang ins Lab eine große Reihe neuer anforderungen. Es wir notwendig sein, ein neu konzipiertes Zuganssystem zu entwerfen. Aurlock Quest soll die endgültige Version dieser Lösung sein. Gut durchdacht, sicher, benutzerfreundlich, sorfältig ausgeführt. Anfang Mai 2022 wurden aber schon stimmen nach einer temporären Lösung laut. Hierraus entstand der Anstoß zu Airlock Zvezda.

# AirLock Zvezda
Prinzipiell sind die Grundanforderungen an dieses System sehr überschaubar: Das Haustelefon von Seidle wird noch nicht ersetzt, Zvezda ist nur eine temporäre addition an dieses System. 

Zvezda basiert auf einem Pi 3 B. Über die GPIOs werden zwei Relays bedient, die tasten die 12VAC Schaltspannungen für Buzzer außen und innen (tbc).

Wir haben gerade Chip-Knappheit. Daher wird das mit dem umgesetzt, was zur verfügung steht:

* Ein Relay-Board zum Prototyping mit Arduino (krobin)
* Ein Teenzy Board als absolut overkill pegelwandler (phjl)
* Ein Raspberry Pi 3B (krobin)

craftamap hat eine kleine Software in Go entwickelt, die per basic auth eine webseite bereitstellt, mit der über zwei schaltflächen "Innentür" und "Außentür" am Pi zwei GPIOs geschaltet werden können. Die Ausgänge (3.3V) des Pi gehen an die analog-Eingänge des Teenzy-Board, an den Digitalausgängen kommen dann anständige 5V Pegel raus. Daran ist das Relay-Bard angeschlossen, das schaltet dann die buzzer.

Die Software ist auf github: [https://github.com/openlab-aux/airlock/tree/master/zvezda](https://github.com/openlab-aux/airlock/tree/master/zvezda)

**Die Klingel geht genauso wie vorher weiterhin. Die Verbindung von Klingel Innen zum Buzzer innen wurde getrennt und durch Airlock ersetzt. Auch das wird mit Quest wieder schöner.**

### Der Aufbau

![](https://www.openlab-augsburg.de/wp-content/uploads/2022/05/rn_image_picker_lib_temp_ae098c2a-a79a-42ba-9967-6e3bf9de745d.jpg)

* Der Pi 3B hängt mit craftamaps software per LAN im Netz und ist über [http://172.16.0.248:3000/](http://172.16.0.248:3000/) erreichbar
* Für einen account krobin anschreiben
* Der Pi gibt Logikpegel an GPIO 12 und 16 aus, die gehen weiter zum Tennzy auf dem Breadboard
* Weil die Logikpegel genau falsch rum sind, werden die vom Teenzy einmal umgedreht und mit 5V Pegel weiter gegeben
* Das Relay Board schaltet dann die tatsächlichen Kontakte. Die sind im Gehäuse des Seidle Haustelefons verstaut, Belegung steht weiter unten.

# AirLock Quest

Die dauerhafte Lösung, AirLock Quest, bildet deutlich mehr ab als Zvezda, braucht aber deswegen auch ein wenig Zeit in der Entwicklung. Die Hardware soll von der Außenwelt geschützt im Serverrack hausen, in einem eigens dazu angepassten 2HE Gehäuse. Die Bedienung soll über sinnvoll verschlüsselte Keyfobs möglich sein, z.b. Desfire EV3.

## Die Anforderungen
* Das Ola hat in der Bäckergasse
	* Zwei Türen
		* Die Haustür außen, hier können wir baulich nichts tun
		* Die Tür innen, ab hier können wir modifizieren
		* Beide Türen sind mit einem Türöffner versehen. Wie die jeweils angesteuert sind, ist unklar
	* Eine Türklingel, drückbar von ganz außen
		* Die könnte man als Zugangssteuerung verwenden, muss aber stets beachten, dass hier ahnungslose gäste klingeln können
	* Eine Gegensprechanlage
* Wir dürfen gemäß Günther Modifikationen an der Anlage vornehmen. Es ist aber davon auszugehen, dass alles außerhal der Ola-Räumlichkeiten natürlich Off-Limits ist
* Das neue System braucht mehr Stati als das alte. Durch die verteilteren Räumlichkeiten ist es oft möglich, nicht mitzubekommen, wenn jemand ungeahnt zur Tür rein kommt, zum Beispiel weil man hackend im Keller sitzt oder eine abgeteilte Workshopgruppe produktiv arbeitet. Das neue System muss das abbilden
* Aus Erfahrung ist es förderlich, die Verwaltung der Schließberechtigung in ein modifikaionsresistenteres Modell zu überführen. Auch dem soll das neue System rechnung tragen, zum Beispiel durch erhöhte physikalische Sicherheit der Steuerelektronik

## Anschlüsse

An der Hausanlage steckt ein Seidle 811. Gegeben der Herstellerspezifikation ergänzt durch ein wenig eigene Vorgaben ergibt sich folgende Pinout-Tabelle an der Dose:

+---------------+--------------------------------------+
| Pin(Seidle)   | Funktion                             |
+===============+======================================+
| 6.1           | Tastkontakt Türöffner (außen) A      |
+---------------+--------------------------------------+
| I             | Tastkontakt Türöffner (außen) B      |
+---------------+--------------------------------------+
| 6.2           | Tastkontakt Licht A                  |
+---------------+--------------------------------------+
| II            | Tastkontakt Licht B                  |
+---------------+--------------------------------------+
| G             | Ansteuerung für Gong                 |
+---------------+--------------------------------------+
| 10            | Ansteuerung für Etagenruf (Dauerton) |
+---------------+--------------------------------------+
| 7             | Ansteuerung für Türruf (Alphaton)    |
+---------------+--------------------------------------+
| c             | Bezugspunkt Rufsignale (GND)         |
+---------------+--------------------------------------+
| b             | Versorgung Gong (dauerhaft 12V AC)   |
+---------------+--------------------------------------+
| 1             | Impuls Mithörsperre                  |
+---------------+--------------------------------------+
| 9             | Bezugspunkt Audio (GND)              |
+---------------+--------------------------------------+
| 11            | Mikrofon (Mi)                        |
+---------------+--------------------------------------+
| 12            | Lauthörkapsel (Ls)                   |
+---------------+--------------------------------------+

+---------------+--------------------+
| Pin(Extra)    | Funktion           |
+===============+====================+
| 20            | Klingel innen AC 2 |
+---------------+--------------------+
| 21            | Buzzer innen AC A  |
+---------------+--------------------+
| 22            | Buzzer innen AC B  |
+---------------+--------------------+

## Übergabepunkt Seidle -> AirLock

Anfangs übergeben wir die Signale zwischen Anlage des Hauses und Airlock über einen Klemmblock mit bezeichnungen, die 1:1 der Vorlage von Seidle entsprechen. So kann selbst ein fremder Haustechniker, der sich nur mit Seidle-Anlagen auskennt, irgendwas tun. Breaking Changes durch Änderungen an der Hausanlage wären natürlich ärgerlich, aber mit den Herstellernahen Übergabepunkt ist auch für einen fremden Techniker einfach zu erkennen, dass wir uns lediglich an die Anlage angehängt haben, die Anlage dabei aber nicht in irgend einer Weise stören wollen.

Das Haustelefon ist auf einer normalen Unterputzdose montiert, also 60mm Lochabstand an den Montagelöchern. Eine selbst gedruckte Dose stellt die Verbidnungen gemäß dem Originalzustand her und ermöglicht es, eine eigene Leitung anzufügen. Das passiert nach folgendem Schema, wobei die Adernfarben in der Hausanlage schön mehrdeutig sind.
Weiter geht es mit Klingeldraht (?)

### Anschlussschema Übergabepunkt